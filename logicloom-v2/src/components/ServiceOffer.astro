---
import { Icon } from 'astro-icon/components';

interface Props {
  title: string;
  price: string;
  frequency: string; // e.g., "/ one-time" or "/ month"
  description: string;
  features: string[];
  ctaText?: string;
  ctaLink?: string;
  popular?: boolean; // Toggles the "Most Popular" styling
  bonus?: string; // Optional text for the "Included Bonus" box
  triggerModal?: boolean;
}

const { 
  title, 
  price, 
  frequency, 
  description, 
  features, 
  ctaText = "Get Started", 
  ctaLink = "#contact",
  popular = false,
  bonus,
  triggerModal = false 
} = Astro.props;
---

<div class={`flex flex-col rounded-2xl bg-white transition-all duration-300 h-full ${popular ? 'border-2 border-indigo-600 shadow-xl relative scale-105 z-10' : 'border border-gray-200 shadow-sm hover:shadow-md'}`}>
  
  {/* Popular Badge */}
  {popular && (
    <div class="absolute -top-5 left-0 right-0 mx-auto w-32 rounded-full bg-indigo-600 px-3 py-1 text-center text-sm font-medium text-white shadow-lg">
      Most Popular
    </div>
  )}

  <div class="p-8">
    <h3 class={`text-lg font-semibold leading-8 ${popular ? 'text-indigo-600' : 'text-slate-900'}`}>
      {title}
    </h3>
    <p class="mt-4 text-sm leading-6 text-gray-600 min-h-[48px]">
      {description}
    </p>
    <p class="mt-8 flex items-baseline gap-x-1">
      <span class="text-4xl font-bold tracking-tight text-slate-900">{price}</span>
      <span class="text-sm font-semibold leading-6 text-gray-600">{frequency}</span>
    </p>

    {/* Dynamic CTA Button */}
    {triggerModal ? (
      <button 
        type="button"
        @click="$dispatch('open-modal')"
        class={`mt-8 block w-full rounded-full px-3 py-3 text-center text-sm font-semibold leading-6 shadow-sm transition-all active:scale-95 cursor-pointer ${
          popular 
            ? 'bg-indigo-600 text-white hover:bg-indigo-500 shadow-indigo-200' 
            : 'bg-slate-900 text-white hover:bg-slate-800'
        }`}
      >
        {ctaText}
      </button>
    ) : (
      <a 
        href={ctaLink}
        class={`mt-8 block w-full rounded-full px-3 py-3 text-center text-sm font-semibold leading-6 shadow-sm transition-all active:scale-95 ${
            popular 
              ? 'bg-indigo-600 text-white hover:bg-indigo-500 shadow-indigo-200' 
              : 'bg-indigo-50 text-indigo-600 hover:bg-indigo-100'
          }`}
      >
        {ctaText}
      </a>
    )}
  </div>

  <div class="flex-1 border-t border-gray-100 bg-gray-50 p-8 rounded-b-2xl">
    <ul role="list" class="space-y-4 text-sm leading-6 text-gray-600">
      {features.map((item) => (
        <li class="flex gap-x-3">
          <Icon name="ph:check-circle-fill" class={`h-6 w-5 flex-none ${popular ? 'text-indigo-600' : 'text-slate-400'}`} />
          {item}
        </li>
      ))}

      {/* Optional Bonus Section (Retainer) */}
      {bonus && (
        <li class="mt-4 pt-4 border-t border-indigo-100">
            <div class="rounded-lg bg-indigo-50 p-3 border border-indigo-100">
                <p class="font-semibold text-indigo-700 text-xs uppercase tracking-wide">Included Bonus</p>
                <p class="mt-1 text-sm text-indigo-900 font-medium">
                    {bonus}
                </p>
            </div>
        </li>
      )}
    </ul>
  </div>
</div>